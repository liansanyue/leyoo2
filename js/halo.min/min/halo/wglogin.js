halo.use(function(a){halo.add("wglogin",function(){function b(a){var b=new RegExp("(^| )"+a+"(?:=([^;]*))?(;|$)"),c=document.cookie.match(b);return c?c[2]?unescape(c[2]):"":null}var c=navigator.userAgent.toLowerCase(),d=window.WeixinJSBridge;d||(d=c.match(/micromessenger/)?!0:!1);var e=function(){var a=b("wg_skey")&&b("wg_uin")||b("p_skey")&&b("p_uin")||b("skey")&&b("uin")?!0:!1,c=b("sid")||"";return c&&a},f=function(){if("wanggou.com"!=window.location.host&&window.location.host.indexOf(".wanggou.com")<0){var b="http://mm.wanggou.com/halo/wxlogin.html",c=window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/\/[^\/]*$/,"")+"/afterLogin.html",d=window.location.pathname,e=d.lastIndexOf("/"),f=d.length;d=d.substring(e+1,f)}else var b=window.location.protocol+"//"+window.location.host+window.location.pathname;var g=a.request(),h=parseInt(g.wglogin_ts)||0,i=(new Date).getTime();if(3e4>i-h)return alert("\u767b\u5f55\u5931\u8d25"),void 0;b+="?wglogin_ts="+i,"string"==typeof d&&(b+="&s="+d),"string"==typeof c&&(b+="&ru="+encodeURIComponent(c));for(var j in g)"wglogin_ts"!=j&&"s"!=j&&(b+="&"+j+"="+g[j]);window.location.href="http://party.wanggou.com/tws64/m/wxv2/Login?appid=1&rurl="+encodeURIComponent(b)},g=function(){if("wanggou.com"!=window.location.host&&window.location.host.indexOf(".wanggou.com")<0){var b=window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/\/[^\/]*$/,"")+"/afterLogin.html",c=window.location.pathname,d=c.lastIndexOf("/"),e=c.length;c=c.substring(d+1,e)}else var b=window.location.protocol+"//"+window.location.host+window.location.pathname;var f=a.request(),g=parseInt(f.wglogin_ts)||0,h=(new Date).getTime();return 3e4>h-g?(alert("\u767b\u5f55\u5931\u8d25"),void 0):(b+="?wglogin_ts="+h,"string"==typeof c&&(b+="&s="+c),b=encodeURIComponent(b),window.location.href="http://mm.wanggou.com/halo/login.html?v="+(new Date).getTime()+"&ru="+b,void 0)},h=function(){"qq"==h.type?g():"wx"==h.type?f():d?f():g()};return h.isLogin=e,h}())});